const axios = require("axios");
const fs = require("fs");
const path = require("path");

// üîê Replace these with your real pCloud login credentials
const PCLOUD_EMAIL = "nwankwofrancis2009@gmail.com";
const PCLOUD_PASSWORD = "Onyedika";

// üîΩ The file you want to upload
const FILE_PATH = "video_thumbnail.png";

// üîÅ Main function
(async () => {
  try {
    // Step 1: Log in to pCloud
    const loginRes = await axios.get("https://api.pcloud.com/login", {
      params: {
        getauth: 1,
        username: PCLOUD_EMAIL,
        password: PCLOUD_PASSWORD,
      },
    });

    if (loginRes.data.result !== 0) {
      console.error("‚ùå Login failed:", loginRes.data);
      return;
    }

    const authToken = loginRes.data.auth;
    console.log("‚úÖ Logged in. Auth token:", authToken);

    // Step 2: Upload file
    const fileStream = fs.createReadStream(FILE_PATH);
    const uploadRes = await axios.post(
      `https://api.pcloud.com/uploadfile?auth=${authToken}&filename=${path.basename(FILE_PATH)}`,
      require("form-data").prototype.append.call(
        new (require("form-data"))(),
        "file",
        fileStream
      ),
      {
        headers: {
          ...new (require("form-data"))().getHeaders(),
        },
      }
    );

    if (uploadRes.data.result === 0) {
      console.log("‚úÖ Upload successful:", uploadRes.data.metadata.name);
    } else {
      console.error("‚ùå Upload failed:", uploadRes.data);
    }
  } catch (err) {
    console.error("‚ùå Error:", err.message);
  }
})();
